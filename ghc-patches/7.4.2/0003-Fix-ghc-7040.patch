From cd6531a300bc540436e93b4eb2269dd1b3190ffa Mon Sep 17 00:00:00 2001
From: Edsko de Vries <edsko@well-typed.com>
Date: Tue, 5 Mar 2013 08:20:33 +0000
Subject: [PATCH 3/9] Fix ghc #7040

This should fix the build problems with learning-site.
---
 rts/Linker.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/rts/Linker.c b/rts/Linker.c
index 153a970..5f44137 100644
--- a/rts/Linker.c
+++ b/rts/Linker.c
@@ -5765,8 +5765,13 @@ ocGetNames_MachO(ObjectCode* oc)
 
         if((sections[i].flags & SECTION_TYPE) == S_ZEROFILL)
         {
+#ifdef USE_MMAP
+            char * zeroFillArea = mmapForLinker(sections[i].size, MAP_ANONYMOUS, -1);
+            memset(zeroFillArea, 0, sections[i].size);
+#else
             char * zeroFillArea = stgCallocBytes(1,sections[i].size,
                                       "ocGetNames_MachO(common symbols)");
+#endif
             sections[i].offset = zeroFillArea - image;
         }
 
-- 
1.7.12.4 (Apple Git-37)

